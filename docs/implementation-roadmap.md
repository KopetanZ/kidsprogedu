# 実装ロードマップ

## 🎯 現在の状況（2025年10月）

### ✅ 完了している機能

#### **コア機能**
- [x] 基本的なブロックプログラミングエディタ
- [x] ドラッグ&ドロップ/タップ操作
- [x] アニメーション付き実行
- [x] ゴール判定システム

#### **学習モード（5種類）**
- [x] **Drillモード** - 基本的な問題解決
- [x] **Parsonsモード** - ブロック並べ替え問題
- [x] **Debugモード** - バグ修正問題
- [x] **Challengeモード** - 制約付き課題
- [ ] **Projectモード** - 自由創作（未実装）

#### **スキーマとデータ構造**
- [x] LessonSchema拡張（type/skills/difficulty/subgoals/prerequisites）
- [x] ParsonsDataSchema
- [x] DebugDataSchema
- [x] ChallengeDataSchema
- [x] 変数ブロックのスキーマ（set_var/change_var/repeat_var）
- [x] 必須ブロックチェック機能

#### **UI/UXコンポーネント**
- [x] サブゴールチェックリスト
- [x] スキルマップ（6スキル対応）
- [x] バッジシステム（11種類）
- [x] バッジ通知
- [x] BGMシステム（menu/editor）
- [x] 強化版チュートリアル
- [x] 変数インスペクタUI
- [x] ステップ実行コントロールUI
- [x] Challenge制約表示

#### **サンプルレッスン**
- [x] L1_01_go_right.json（基本移動 + メタデータ）
- [x] L1_02_parsons_right.json（Parsonsサンプル）
- [x] L1_03_sound_move.json（音ブロック必須）
- [x] L1_03_debug_right.json（Debugサンプル）
- [x] L2_01_challenge_loop.json（Challengeサンプル）

---

## 🚀 次のステップ（優先度順）

### **Phase 1: 変数システムの完全実装**（優先度：高）

#### 1.1 実行エンジンへの変数統合
- [ ] `core/engine/vm.ts`に変数管理機能を追加
  - [ ] 変数ストアの実装
  - [ ] `set_var`ブロックの実行ロジック
  - [ ] `change_var`ブロックの実行ロジック
  - [ ] `repeat_var`ブロックの実行ロジック
- [ ] `core/engine/runtime.ts`の変数状態管理
- [ ] 変数インスペクタとの連携

#### 1.2 変数ブロックのUI実装
- [ ] BlockItemで変数ブロックの表示
- [ ] エディタでの変数ブロック追加
- [ ] 変数名・値の編集UI

#### 1.3 変数を使うレッスン作成
- [ ] L3_01_variable_intro.json（変数の導入）
- [ ] L3_02_variable_loop.json（変数で繰り返し）
- [ ] L3_03_variable_challenge.json（変数を使うチャレンジ）

**想定工数**: 3-4時間
**期待効果**: 高度なプログラミング概念の学習が可能に

---

### **Phase 2: ステップ実行機能の実装**（優先度：高）

#### 2.1 実行エンジンのステップモード対応
- [ ] `Runtime`にステップ実行モードを追加
- [ ] 1命令ずつ実行する機能
- [ ] 実行状態の保存・復元
- [ ] ブレークポイント機能（オプション）

#### 2.2 UIとの連携
- [ ] StepExecutionControlsの実装
- [ ] 現在実行中のブロックのハイライト
- [ ] 変数インスペクタのリアルタイム更新
- [ ] 再生/一時停止/ステップ進む/戻る

#### 2.3 デバッグ支援機能
- [ ] 実行トレースの記録
- [ ] エラー発生時の状態表示

**想定工数**: 4-5時間
**期待効果**: デバッグスキルの向上、理解度の深化

---

### **Phase 3: Projectモードの実装**（優先度：中）

#### 3.1 自由創作モードの基礎
- [ ] ProjectDataSchemaの定義
- [ ] 空のキャンバスでの自由制作
- [ ] 作品の保存・読み込み
- [ ] 作品一覧画面

#### 3.2 テンプレートシステム
- [ ] テンプレート定義スキーマ
- [ ] 3-5種類のテンプレート作成
  - [ ] シンプルなアニメーション
  - [ ] インタラクティブな作品
  - [ ] ゲーム風の作品

#### 3.3 作品共有機能（オプション）
- [ ] 作品のエクスポート（JSON）
- [ ] 作品のインポート
- [ ] QRコード生成で共有

**想定工数**: 5-6時間
**期待効果**: 創造性の発揮、学習の定着

---

### **Phase 4: マイクロ動画レッスン**（優先度：中）

#### 4.1 動画システムの設計
- [ ] VideoDataSchemaの詳細化
- [ ] 動画プレイヤーコンポーネント
- [ ] 字幕表示機能
- [ ] 再生速度調整

#### 4.2 インタラクティブ要素
- [ ] 動画内クイズの実装
- [ ] 予測問題の挿入
- [ ] 選択肢問題の実装

#### 4.3 動画コンテンツ制作
- [ ] 各概念の2-3分動画を制作
  - [ ] 逐次実行の説明
  - [ ] 繰り返しの説明
  - [ ] 条件分岐の説明
  - [ ] 変数の説明

**想定工数**: 8-10時間（動画制作含む）
**期待効果**: 視覚的学習の強化、理解度向上

---

### **Phase 5: 残りのレッスンへのメタデータ追加**（優先度：中）

#### 5.1 一括更新スクリプトの完成
- [ ] `scripts/add-lesson-metadata.ts`の動作確認
- [ ] Node.js互換性の修正
- [ ] 全42レッスンへの適用

#### 5.2 レッスンの見直し
- [ ] 各レッスンの難易度調整
- [ ] サブゴールの追加
- [ ] 必須ブロックの設定
- [ ] スキル分類の最適化

**想定工数**: 2-3時間
**期待効果**: 一貫性のある学習体験

---

### **Phase 6: アダプティブ難易度システム**（優先度：低）

#### 6.1 学習データの収集
- [ ] テレメトリの拡張
- [ ] ヒント使用頻度の記録
- [ ] 試行回数の記録
- [ ] クリア時間の記録

#### 6.2 難易度調整ロジック
- [ ] ユーザーのスキルレベル判定
- [ ] 動的なヒント提供
- [ ] スキップ機能の提案
- [ ] 復習レッスンの提案

**想定工数**: 6-8時間
**期待効果**: 個別最適化された学習体験

---

### **Phase 7: 教員・保護者向け機能**（優先度：低）

#### 7.1 レポート機能
- [ ] 学習進捗レポート
- [ ] スキル別達成度
- [ ] ヒント依存度の分析
- [ ] CSVエクスポート

#### 7.2 管理機能
- [ ] 複数ユーザーの管理
- [ ] レッスンの有効/無効切り替え
- [ ] カスタムレッスンの作成

**想定工数**: 4-5時間
**期待効果**: 教育現場での活用促進

---

## 📊 実装の優先順位マトリクス

| 機能 | 優先度 | 影響度 | 工数 | 開始推奨時期 |
|------|--------|--------|------|------------|
| 変数システム完成 | 🔴 高 | 大 | 3-4h | 即時 |
| ステップ実行 | 🔴 高 | 大 | 4-5h | 変数完了後 |
| メタデータ追加 | 🟡 中 | 中 | 2-3h | いつでも可 |
| Projectモード | 🟡 中 | 大 | 5-6h | Phase 1-2後 |
| マイクロ動画 | 🟡 中 | 中 | 8-10h | Phase 3後 |
| アダプティブ | 🟢 低 | 中 | 6-8h | Phase 4後 |
| 教員向け機能 | 🟢 低 | 小 | 4-5h | 最終段階 |

---

## 🎯 推奨実装順序

1. **変数システム完成** → プログラミングの核心概念
2. **ステップ実行** → デバッグスキル向上
3. **残りレッスンのメタデータ** → 一貫性確保
4. **Projectモード** → 創造性の発揮
5. **マイクロ動画** → 理解度向上
6. **アダプティブ難易度** → 個別最適化
7. **教員向け機能** → 教育現場対応

---

## 📝 技術的な注意事項

### 変数システム実装時
- VMのステート管理を慎重に設計
- 変数スコープの考慮（グローバルのみで開始）
- 型システムの拡張（数値→文字列も将来対応）

### ステップ実行実装時
- パフォーマンスに注意（RAF使用）
- 状態の不変性を保つ
- UIのちらつき防止

### Projectモード実装時
- LocalStorageの容量制限に注意
- 作品データのバージョニング
- 後方互換性の確保

---

## 🔗 参考資料

- [改善仕様書](./improvement-spec-ja.md)
- [既存の実装状況](../README.md)
- Scratch: https://scratch.mit.edu/
- Code.org: https://code.org/

---

**最終更新**: 2025年10月7日
**次回レビュー推奨**: Phase 1完了時
